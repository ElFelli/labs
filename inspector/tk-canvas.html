<!--
Copyright 2013 The Toolkitchen Authors. All rights reserved.
Use of this source code is governed by a BSD-style
license that can be found in the LICENSE file.
-->
<element name="tk-canvas" Xon-mousemove="move" on-mouseup="up">
  <template>
    <style>
      @host {
        * {
          background-image: url(assets/dot.png)
        }
      }
    </style>
    <div id="box" style="position: absolute; width: 16px; height: 16px; left: -1000px; border: 1px solid lightblue; pointer-events: none;"></div>
    <content></content>
  </template>

  <script>
    Toolkit.register(this, {
      grid: 16,
      snap: function(inX, inY) {
        return {
          x: Math.round(inX / this.grid) * this.grid,
          y: Math.round(inY / this.grid) * this.grid
        };
      },
      move: function(event) {
        if (event.target === this) {
          var p = this.snap(event.offsetX, event.offsetY);
          this.$.box.style.left = p.x + 'px';
          this.$.box.style.top = p.y + 'px';
        }
      },
      up: function(event) {
        this.send('canvas-drop', this.snap(event.offsetX, event.offsetY));
      }
    });
  </script>

</element>