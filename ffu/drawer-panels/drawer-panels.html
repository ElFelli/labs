<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../polymer-media-query/polymer-media-query.html">

<polymer-element name="drawer-panels" on-keydown="{{handleKeydown}}" tabindex="0">
  <template>
    <style>
      :host {
        display: block;
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
      }
      #navPanel {
        position: absolute;
        top: 0;
        left: 0;
        width: 256px;
        height: 100%;
        box-sizing: border-box;
        -mox-box-sizing: border-box;
        border-right: 1px solid #ccc;
        box-shadow: -8px 0px 8px -4px rgba(0, 0, 0, 0.15);
        background-color: #fff;
        z-index: 1;
        overflow: auto;
        transition: left ease-in-out 0.5s;
      }
      /*@polyfill :host [nav] */
      ::content[select="[nav]"] > * {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        box-sizing: border-box;
        -moz-box-sizing: border-box;
      }
      #mainPanel {
        position: absolute;
        top: 0;
        right: 0;
        bottom: 0;
        left: 256px;
        padding: 0 16px;
        transition: left ease-in-out 0.5s;
      }
      #cardPanel {
        position: relative;
        margin: 0 auto;
        max-width: 640px;
        height: 100%;
        overflow: auto;
      }
      /*@polyfill :host [content] */
      ::content[select="[content]"] > * {
        position: absolute;
        top: 0;
        left: 4px;
        right: 4px;
        height: auto;
        box-sizing: border-box;
        -moz-box-sizing: border-box;
        margin: 20px 0;
        background-color: #fff;
        border-radius: 2px;
        box-shadow: rgba(0, 0, 0, 0.14902) 0px 2px 4px, rgba(0, 0, 0, 0.14902) 0px 0px 3px;
      }
      #scrim {
        position: absolute;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
        background-color: rgba(0, 0, 0, 0.3);
        opacity: 0;
        visibility: hidden;
        transition: opacity ease-in-out 0.38s, visibility ease-in-out 0.38s;
      }
      @media all and (max-width: 640px) {
        #navPanel:not(.show-content)  {
          border: 0;
          box-shadow: 2px 2px 4px rgba(0, 0, 0, 0.15);
        }
        #navPanel.show-content {
          left: -260px;
        }
        #mainPanel {
          left: 0;
          padding: 0;
        }
        #mainPanel:not(.show-content) #scrim {
          visibility: visible;
          opacity: 1;
        }
        /*@polyfill :host [content] */
        ::content[select="[content]"] > * {
          margin: 0;
          min-height: 100%;
          left: 0;
          right: 0;
        }
      }
    </style>
    
    <div id="navPanel">
      <content select="[nav]"></content>
    </div>
    
    <div id="mainPanel" >
      <div id="cardPanel">
        <content select="[content]"></content>
      </div>
      <div id="scrim" on-tap="{{togglePanel}}"></div>
    </div>
    
    <polymer-media-query query="{{query}}" queryMatches="{{queryMatches}}"></polymer-media-query>
    
  </template>
  <script>
    Polymer('drawer-panels', {
      query: 'max-width: 640px',
      togglePanel: function(contentShowing) {
        ['navPanel', 'mainPanel'].forEach(function(n) {
          var cl = this.$[n].classList;
          var t = contentShowing === undefined ? !cl.contains('show-content') : contentShowing;
          cl.toggle('show-content', t);
        }, this);
      },
      queryMatchesChanged: function() {
        if (!this.queryMatches) {
          this.togglePanel(true);
        }
      },
      handleKeydown: function(e) {
        if (e.keyCode == 27) {
          this.togglePanel();
        }
      }
    });
  </script>
</polymer-element>
