<link href="../../../../polymer-elements/polymer-grid-layout/polymer-grid-layout.html" rel="import">
<link href="../../../../polymer-elements/polymer-media-query/polymer-media-query.html" rel="import">
<link href="../../../../polymer-ui-elements/polymer-ui-toolbar/polymer-ui-toolbar.html" rel="import">
<link href="../../../../polymer-ui-elements/polymer-ui-icon-button/polymer-ui-icon-button.html" rel="import">
<link href="../../../list/elements/polymer-list/polymer-list.html" rel="import">
<link href="contacts-list-item.html" rel="import">
<link href="contacts-detail.html" rel="import">
<polymer-element name="contacts-list">
	<template>
		<style>
			/* @polyfill @host */
			:host {
				position: absolute;
				top: 0;
				left: 0;
				bottom: 0;
				right: 0;
			}
			polymer-ui-toolbar {
				padding-left: 10px;
				padding-right: 10px;
			}
			.clip {
				overflow: hidden;
				position: relative;
			}
			#listContainer {
				position: absolute;
				top: 0;
				right: 0;
				left: 0;
				bottom: 0;
				background-color: rgb(242, 242, 242),
				min-width: 320px;
				overflow-y: scroll;
			}
			#overlay {
				position: fixed;
				top: 0;
				left: 0;
				bottom: 0;
				right: 0;
			}
			#overlay::x-overlay {
				height: 100%;
			}
			contacts-detail {
				min-width: 65%;
			}
			/* @polyfill .sticky */
			content::-webkit-distributed(.sticky) {
				position: absolute;
				top: 0;
				left: 0;
				right: 0;
				z-index: 10;
			}
			polymer-list {
				height: 100%;
			}
			.contactItem.header {
		    background: #f2f2f2 -webkit-linear-gradient(top, rgba(197,197,197,0), rgba(197,197,197,0.15));
		    background: #f2f2f2 -moz-linear-gradient(top, rgba(197,197,197,0), rgba(197,197,197,0.15));
		    background: #f2f2f2 -ms-linear-gradient(top, rgba(197,197,197,0), rgba(197,197,197,0.15));
		    color: #9f9f9f;
				font-variant: small-caps;
				height: 60px;
				padding: 20px;
			}
			[wideLayout] .contactItem.polymer-selected {
		    background: #f2f2f2 -webkit-linear-gradient(top, rgba(197,197,197,0), rgba(197,197,197,0.15));
		    background: #f2f2f2 -moz-linear-gradient(top, rgba(197,197,197,0), rgba(197,197,197,0.15));
		    background: #f2f2f2 -ms-linear-gradient(top, rgba(197,197,197,0), rgba(197,197,197,0.15));
		  }
		</style>
		<mock-data id="mock"></mock-data>
		<polymer-media-query query="min-width: 768px" queryMatches="{{wideLayout}}"></polymer-media-query>
		<polymer-grid-layout id="grid"></polymer-grid-layout>
		<polymer-ui-toolbar theme="polymer-ui-dark-theme">
			<polymer-ui-icon-button icon="menu" on-tap="menuAction"></polymer-ui-icon-button>
			<div flex>Everyone</div>
			<polymer-ui-icon-button icon="plus" on-tap="addAction"></polymer-ui-icon-button>
			<polymer-ui-icon-button icon="search"></polymer-ui-icon-button>
			<template if="{{wideLayout}}">
				<polymer-ui-icon-button icon="shortcut"></polymer-ui-icon-button>
				<polymer-ui-icon-button icon="favorite"></polymer-ui-icon-button>
			</template>
		</polymer-ui-toolbar>
		<div class="clip" flex>

			<polymer-list data="{{$.mock.contacts}}" listData="{{listData}}">
				<template repeat="{{contact in listData}}">
					<contacts-list-item class="{{contact.page}}" contact="{{contact}}" xon-tap="selectContactAction">
					</contacts-list-item>
				</template>
			</polymer-list>

<!-- 		 	<content select=".sticky"></content>
			<div id="listContainer">
				<shadow></shadow>
				<polymer-ui-overlay id="overlay">
					<contacts-detail contact="{{selectedModel.contact}}" on-contacts-detail-shrink="overlayCloseAction">
					</contacts-detail>
				</polymer-ui-overlay>
			</div>
 -->			
				<polymer-ui-overlay id="overlay">
					<contacts-detail contact="{{selectedContact.contact}}" on-contacts-detail-shrink="overlayCloseAction">
					</contacts-detail>
				</polymer-ui-overlay>
		</div>
		<contacts-detail contact="{{selectedContact.contact}}" on-contacts-detail-shrink="overlayCloseAction">
		</contacts-detail>
	</template>
	<script>
		Polymer('contacts-list', {
			applyAuthorStyles: true,
			selected: -1,
			wideLayout: true,
			ready: function() {
				// this.$.listContainer.onscroll = function(e) {
				// 	this.fire('contacts-list-scroll', this.$.listContainer.scrollTop);
				// }.bind(this);
				this.wideLayoutChanged();
			},
			wideLayoutChanged: function() {
				if (this.wideLayout) {
					this.$.overlay.active && (this.$.overlay.active = false);
					this.$.grid.layout = [
						[3, 3],
						[4, 5],
						[4, 5],
					];
				} else {
					this.$.grid.layout = [
						[3, 3],
						[4, 4],
						[4, 4],
					];
				}
			},
			addAction: function() {
				this.fire('contacts-list-add');
			},
			menuAction: function() {
				this.fire('contacts-menu-open');
			},
			selectContactAction: function(e, detail, sender) {
				this.selectedContact = sender.templateInstance.model;
				if (!this.wideLayout) {
					this.$.overlay.active = true;
				}
			},
			overlayCloseAction: function() {
				this.$.overlay.active = false;
			}
		})
	</script>
</polymer-element>